-- 실습 10-1
DROP TABLE DEPT_TEMP;

  CREATE TABLE DEPT_TEMP 
   (	"DEPTNO" NUMBER(2,0), 
        "DNAME" VARCHAR2(14 BYTE), 
        "LOC" VARCHAR2(13 BYTE), 
        CONSTRAINT "PK_DEPT_TEMP" PRIMARY KEY ("DEPTNO")
    );
SELECT * FROM DEPT_TEMP;

DROP TABLE DEPT_TEMP;

CREATE TABLE DEPT_TEMP  --DEPT 테이블 복사해서 테이블 만듬
    AS SELECT * FROM DEPT;

-- 실습 10-2
SELECT * FROM DEPT_TEMP;

-- 실습 10-3
INSERT INTO DEPT_TEMP (DEPTNO, DNAME, LOC)
VALUES (50, 'DATABASE', 'SEOUL');

SELECT * FROM DEPT_TEMP;

-- 실습 10-4
INSERT INTO DEPT_TEMP
VALUES (60 , 'NETWORK', 'BUSAN');

SELECT * FROM DEPT_TEMP;

-- 실습 10-5
INSERT INTO DEPT_TEMP (DEPTNO, DNAME, LOC)
VALUES (70 , 'WEB', NULL);

SELECT * FROM DEPT_TEMP;

-- 실습 10-6
INSERT INTO DEPT_TEMP (DEPTNO, DNAME , LOC)
VALUES (80 , 'MOBILE', '');

SELECT * FROM DEPT_TEMP;

-- 실습 10-7
INSERT INTO DEPT_TEMP (DEPTNO, LOC)
VALUES (90 , 'INCHEON');

SELECT * FROM DEPT_TEMP;

-- 실습 10-8
DROP TABLE EMP_TEMP;
CREATE TABLE EMP_TEMP
    AS SELECT *
         FROM EMP
        WHERE 1 <> 1
;--FALSE

SELECT * FROM EMP_TEMP;

-- 실습 10-9
INSERT INTO EMP_TEMP (EMPNO, ENAME, JOB,  MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (9999, '홍길동', 'PRESIDENT', NULL, '2001/01/01', 5000, 1000, 10);

SELECT * FROM EMP_TEMP;
ROLLBACK;
-- 실습 10-10
INSERT INTO EMP_TEMP (EMPNO, ENAME, JOB,  MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (1111, '성춘향', ' MG', 9999, '2001-01-05', 4000, NULL, 20);

SELECT * FROM EMP_TEMP;

-- 실습 10-11(에러-날자타입)
INSERT INTO EMP_TEMP (EMPNO, ENAME, JOB,  MGR , HIREDATE, SAL , COMM, DEPTNO)
VALUES (2111, '이순신', ' MG', 9999, '07/01/2001', 4000, NULL, 20);

-- 실습 10-12
INSERT INTO EMP_TEMP (EMPNO, ENAME, JOB,  MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (2111, '이순신', ' MG', 9999, 
        TO_DATE('07/01/2001', 'DD/MM/YYYY'), 4000, NULL, 20);

     

SELECT * FROM EMP_TEMP;

-- 실습 10-13
INSERT INTO EMP_TEMP (EMPNO, ENAME, JOB,  MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (3111, '심청이', ' MG', 9999, SYSDATE, 4000, NULL, 30);

SELECT * FROM EMP_TEMP;

-- 실습 10-14
INSERT INTO EMP_TEMP (EMPNO, ENAME, JOB,  MGR, HIREDATE, SAL, COMM, DEPTNO)
SELECT E.EMPNO, E.ENAME, E.JOB, E. MG, E.HIREDATE, E.SAL, E.COMM, E.DEPTNO
  FROM EMP E, SAL S
 WHERE E.SAL BETWEEN S.LOSAL AND S.HISAL
   AND S.GRADE = 1;

SELECT * FROM EMP_TEMP;


-- 실습 10-15
CREATE TABLE DEPT_TEMP2 --DEPT 테이블 복사해서 테이블 생성
    AS SELECT * FROM DEPT;

SELECT * FROM DEPT_TEMP2;
COMMIT;

-- 실습 10-16
UPDATE DEPT_TEMP2
   SET LOC = 'SEOUL';

SELECT * FROM DEPT_TEMP2;

-- 실습 10-17
ROLLBACK;   --위 update문 실행 취소



-- 실습 10-18
UPDATE DEPT_TEMP2
   SET DNAME = 'DATABASE',
       LOC = 'SEOUL'
 WHERE DEPTNO = 40
;
ROLLBACK;
SELECT * FROM DEPT_TEMP2;


-- 실습 10-19
UPDATE DEPT_TEMP2
   SET (DNAME, LOC) = (SELECT DNAME, LOC
                         FROM DEPT
                        WHERE DEPTNO = 30)
 WHERE DEPTNO = 40;

SELECT * FROM DEPT_TEMP2;
COMMIT;

-- 실습 10-20
UPDATE DEPT_TEMP2
   SET DNAME = (SELECT DNAME
                  FROM DEPT
                 WHERE DEPTNO = 40),
       LOC = (SELECT LOC
                FROM DEPT
               WHERE DEPTNO = 40)
 WHERE DEPTNO = 40;
 COMMIT;
 
SELECT *
  FROM DEPT_TEMP2
 WHERE DEPTNO = 40  ;
 
 
 
-- 실습 10-21
UPDATE DEPT_TEMP2
   SET LOC = 'SEOUL'
 WHERE DEPTNO = (SELECT DEPTNO
                   FROM DEPT_TEMP2
                  WHERE DNAME='OPERATIONS');

SELECT * FROM DEPT_TEMP2;

UPDATE DEPT_TEMP2
   SET dname = 'PRODUCT'
WHERE DEPTNO = 40;

-- 실습 10-22
DROP TABLE EMP_TEMP2;
CREATE TABLE EMP_TEMP2
    AS SELECT * FROM EMP;

SELECT * FROM EMP_TEMP2;

-- 실습 10-23
DELETE FROM EMP_TEMP2
 WHERE JOB = 'MGR';

SELECT * FROM EMP_TEMP2;

-- 실습 10-24
DELETE FROM EMP_TEMP2
 WHERE EMPNO IN (SELECT E.EMPNO
                   FROM EMP_TEMP2 E, SAL S
                  WHERE E.SAL BETWEEN S.LOSAL AND S.HISAL
                    AND S.GRADE = 3
                    AND DEPTNO = 30);

SELECT * FROM EMP_TEMP2;

-- 실습 10-25
DELETE FROM EMP_TEMP2;

SELECT * FROM EMP_TEMP2;





-----------------------
SELECT * FROM EMP;

SELECT * FROM DEPT;


CREATE TABLE CHAP10HW_EMP AS SELECT * FROM EMP;
CREATE TABLE CHAP10HW_DEPT AS SELECT * FROM DEPT;
CREATE TABLE CHAP10HW_SALGRADE AS SELECT * FROM SALGRADE;


--Q1 CHAP10HW_DEPT 테이블에 50, 60, 70, 80번 부서를 등록해라
SELECT * FROM CHAP10HW_DEPT;

INSERT INTO CHAP10HW_DEPT (DEPTNO, DNAME, LOC)
VALUES (50, 'ORACLE', 'BUSAN'); 

INSERT INTO CHAP10HW_DEPT (DEPTNO, DNAME, LOC)
VALUES (60, 'SQL', 'ILSAN');
        
INSERT INTO CHAP10HW_DEPT (DEPTNO, DNAME, LOC)
VALUES (70, 'SELECT', 'INCHEON');

INSERT INTO CHAP10HW_DEPT (DEPTNO, DNAME, LOC)
VALUES (80, 'DML', 'BUNDANG');


--Q2 CHAP10HW_EMP 테이블에 다음 8명의 사원 정보를 등록해라
SELECT * FROM CHAP10HW_EMP;

INSERT INTO CHAP10HW_EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (7201, 'TEST_USER1', 'MANAGER', 7788, '2016-01-02', 4500, NULL, 50); 

INSERT INTO CHAP10HW_EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (7202, 'TEST_USER2', 'CLEARK', 7201, '2016-02-21', 1800, NULL, 50);

INSERT INTO CHAP10HW_EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (7203, 'TEST_USER3', 'ANALYST', 7201, '2016-04-11', 3400, NULL, 60);

INSERT INTO CHAP10HW_EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (7204, 'TEST_USER4', 'SALESMAN', 7201, '2016-05-31', 2700, 300, 60);

INSERT INTO CHAP10HW_EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (7205, 'TEST_USER5', 'CLEARK', 7201, '2016-07-20', 2600, NULL, 70);

INSERT INTO CHAP10HW_EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (7206, 'TEST_USER6', 'CLEARK', 7201, '2016-09-08', 2600, NULL, 70);

INSERT INTO CHAP10HW_EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (7207, 'TEST_USER7', 'LECTURE', 7201, '2016-10-28', 2300, NULL, 80);

INSERT INTO CHAP10HW_EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (7208, 'TEST_USER8', 'STUDENT', 7201, '2018-03-09', 1200, NULL, 80);

SELECT * FROM CHAP10HW_EMP;


--Q3 CHAP10HW_EMP에 속한 사원 중 50번 부서에서 근무하는 사원들의 평균 급여보다 많은 급여를 받는 사원들을 70번 부서로 옮겨라
UPDATE CHAP10HW_EMP
SET DEPTNO = 70
WHERE SAL > (SELECT AVG(SAL)
                FROM CHAP10HW_EMP
                WHERE DEPTNO = 50);
                
SELECT * FROM CHAP10HW_EMP
ORDER BY DEPTNO;


--Q4 CHAP10HW_EMP에 속한 사원 중, 60번 부서의 사원 중에 입사일이 가장 빠른 사원보다 늦게 입사한 사원의 급여를 10% 인상하고 80번 부서로 옮겨라
UPDATE CHAP10HW_EMP
SET SAL = SAL * 1.1,
    DEPTNO = 80
WHERE HIREDATE > (SELECT MIN(HIREDATE)
                    FROM CHAP10HW_EMP
                    WHERE DEPTNO = 60);
                    
SELECT * FROM CHAP10HW_EMP
ORDER BY DEPTNO;


--Q5 CHAP10HW_EMP에 속한 사원 중, 급여 등급이 5인 사원을 삭제해라
DELETE FROM CHAP10HW_EMP
WHERE SAL > (SELECT LOSAL
                FROM CHAP10HW_SALGRADE
                WHERE GRADE = 5);
   
--확인                
SELECT * FROM CHAP10HW_EMP;
             
SELECT * FROM CHAP10HW_SALGRADE;
